<!doctype html>
<html lang="en">

<head>
    <style>
        /* 自定义悬浮入口的位置 */
        position_demo {
            position: relative;
            right: 50%;
            bottom: 50%;
        }
    </style>
</head>

<body>
    <h1>ST&P Assistant (demo use only)
    <div id="position_demo"></div>
    <script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.1.0-beta.0/libs/oversea/index.js"></script>
    <script>
        // 自动生成并存储用户唯一标识
        (function generateUserId() {
            let userId = localStorage.getItem('cozeUserId');
            if (!userId) {
                // 优先使用现代浏览器支持的crypto API
                if(crypto && crypto.randomUUID) {
                    userId = crypto.randomUUID();
                } else {
                    // 兼容旧浏览器的UUID生成方案
                    userId = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                        var r = Math.random() * 16 | 0,
                            v = c === 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                }
                localStorage.setItem('cozeUserId', userId);
            }
            window.cozeUserId = userId;
        })();

        const cozeWebSDK = new CozeWebSDK.WebChatClient({
            config: {
                botId: '7456904729336414225',
            },
            auth: {
                type: 'token',
                token: 'pat_v3jVUx89w6MIkiXPDrJ5n2HHcYe91hx6bfGiJkDk6YVaZi56SaSu2cxgYR3Upiqe',
                onRefreshToken: () => 'pat_82GrrdfNWPMnlcY58r98Rzqiev2s5NyrqCR8Ypbh5hOomzZN4ivb325PZAdZ****',
            },
            userInfo: {
                id: window.cozeUserId,  // 使用动态生成的用户ID
                url: 'https://financialrhythm.com/wp-content/uploads/2018/07/happy-face-300x300.png',
                nickname: 'You',
            },
            ui: {
                chatBot: {
                    title: "ST&P Assistant",
                    uploadable: true,
                    width: 1200
                },
                base: {
                    icon: 'https://financialrhythm.com/wp-content/uploads/2018/07/happy-face-300x300.png',
                    layout: 'pc',
                    zIndex: 1000,
                    isShow: true,
                    isNeedClose: true,
                },
                asstBtn: {
                    isNeed: true,
                },
                footer: {
                    isShow: true,
                    expressionText: 'Powered by {{name}}',
                    linkvars: {
                        name: {
                            text: 'A',
                            link: 'https://www.test.com/'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
